<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Election Form</title>
</head>
<body>
  <h1>Election Form</h1>
  <form id="electionForm">
    <div id="positionsContainer"></div>
    <button type="submit">Submit Vote</button>
  </form>

  <div id="status"></div>

  <script>
    const URL = 'https://script.google.com/macros/s/AKfycbxWubZoUo6cgyZ0zO7R96YFLscrz4ZYjEl0NQrOfpSH4iRoGOA4cd29P9D00AGratoP/exec?action=election';
    const POSITIONS = ['President', 'Vice President', 'Secretary', 'Treasurer', 'Auditor', 'P.I.O', 'Pubmat 1', 'Pubmat 2'];

    const container = document.getElementById('positionsContainer');
    const status = document.getElementById('status');
    const form = document.getElementById('electionForm');

    async function fetchNominees(position) {
      const res = await fetch(`${URL}?action=getNames&position=${encodeURIComponent(position)}`);
      if (!res.ok) throw new Error('Network error');
      const data = await res.json();
      return data;
    }

    async function buildForm() {
      status.textContent = 'Loading nominees...';

      for (const pos of POSITIONS) {
        const nominees = await fetchNominees(pos);

        const label = document.createElement('label');
        label.textContent = pos + ': ';
        const select = document.createElement('select');
        select.name = pos;
        select.required = true;

        // Default empty option
        const emptyOption = document.createElement('option');
        emptyOption.value = '';
        emptyOption.textContent = `Select ${pos}`;
        select.appendChild(emptyOption);

        nominees.forEach(name => {
          const option = document.createElement('option');
          option.value = name;
          option.textContent = name;
          select.appendChild(option);
        });

        label.appendChild(select);
        container.appendChild(label);
        container.appendChild(document.createElement('br'));
      }

      status.textContent = '';
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const formData = new FormData(form);
      formData.append('action', 'election');

      status.textContent = 'Submitting vote...';

      try {
        const response = await fetch(URL, {
          method: 'POST',
          body: new URLSearchParams(formData)
        });
        const text = await response.text();
        status.textContent = text;
      } catch (err) {
        status.textContent = 'Error: ' + err.message;
      }
    });

    buildForm();
  </script>
</body>
</html>
