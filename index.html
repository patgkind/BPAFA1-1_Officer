<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Class Officer Nomination</title>
<style>
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding: 18px; max-width: 760px; margin: auto; }
  h1 { margin-bottom: 6px; }
  .card { border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; margin: 10px 0; background: #fff; box-shadow: 0 1px 0 rgba(0,0,0,0.03); }
  label { display: block; font-weight: 600; margin-bottom: 6px; }
  select {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #d0d0d0;
    box-sizing: border-box;
  }
  button {
    padding: 10px 14px;
    border-radius: 8px;
    background: #1976d2;
    color: white;
    border: none;
    cursor: pointer;
    font-weight: 600;
  }
  button[disabled] {
    opacity: 0.6;
    cursor: not-allowed;
  }
  .success {
    color: green;
    margin-top: 10px;
  }
  .error {
    color: #b00020;
    margin-top: 10px;
  }
  .muted {
    color: #666;
    font-size: 0.9em;
  }
</style>
</head>
<body>
  <h1>Class Officer Nomination</h1>
  <p class="muted">Select the nominee's full name for each position, then submit once.</p>

  <form id="nomForm" autocomplete="off">
    <div id="positionsContainer"></div>
    <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
      <button id="submitBtn" type="submit">Submit nominations</button>
      <div id="status" class="muted"></div>
    </div>
  </form>

<script>
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxWubZoUo6cgyZ0zO7R96YFLscrz4ZYjEl0NQrOfpSH4iRoGOA4cd29P9D00AGratoP/exec?action=nomination '; // your deployed URL
  const POSITIONS = ['President', 'Vice President', 'Secretary', 'Treasurer', 'Auditor', 'P.I.O', 'Pubmat 1', 'Pubmat 2'];

  const container = document.getElementById('positionsContainer');
  const submitBtn = document.getElementById('submitBtn');
  const status = document.getElementById('status');

  // Disable form while loading
  submitBtn.disabled = true;
  status.textContent = 'Loading nominees...';

  async function fetchNominees(position) {
    try {
      const response = await fetch(`${SCRIPT_URL}?action=getNames&position=${encodeURIComponent(position)}`);
      if (!response.ok) throw new Error('Network response was not ok');
      const data = await response.json();
      return data;
    } catch (err) {
      console.error(err);
      return [];
    }
  }

  async function buildForm() {
    for (const pos of POSITIONS) {
      const nominees = await fetchNominees(pos);

      const card = document.createElement('div');
      card.className = 'card';

      const label = document.createElement('label');
      label.textContent = pos + ' *';

      const select = document.createElement('select');
      select.name = pos;
      select.required = true;

      // Default empty option
      const emptyOption = document.createElement('option');
      emptyOption.value = '';
      emptyOption.textContent = `Select ${pos}`;
      select.appendChild(emptyOption);

      nominees.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        select.appendChild(option);
      });

      card.appendChild(label);
      card.appendChild(select);
      container.appendChild(card);
    }

    status.textContent = '';
    submitBtn.disabled = false;
  }

  document.getElementById('nomForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    status.textContent = '';
    submitBtn.disabled = true;

    const formData = new FormData(e.target);
    formData.append('action', 'nomination');

    try {
      const response = await fetch(SCRIPT_URL, {
        method: 'POST',
        body: new URLSearchParams(formData),
      });
      const text = await response.text();
      if (text.toLowerCase().includes('success')) {
        status.textContent = 'Nominations submitted, thank you';
        status.className = 'success';
        submitBtn.disabled = true;
      } else {
        status.textContent = 'Error: ' + text;
        status.className = 'error';
        submitBtn.disabled = false;
      }
    } catch (err) {
      status.textContent = 'Network error: ' + err.message;
      status.className = 'error';
      submitBtn.disabled = false;
    }
  });

  buildForm();
</script>
</body>
</html>
